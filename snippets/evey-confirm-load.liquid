{% assign event = product.metafields.evey.event.value | default: product.metafields.evey.event %}
{% if template.name == 'product' and product.type == 'Event' and event.date_type == 'recurring' %}


  <style>
    .product-form__submit.button:not([data-evey-loaded="ready"], [data-evey-loaded="waiting"], [data-evey-loaded="failed"]), .shopify-payment-button {
      pointer-events: none;
      cursor: not-allowed;
      opacity: 0.5;
    }
  </style>

 <script>
    function enableBtnCSS(input){
      input.style.pointerEvents = 'auto'
      input.style.cursor = 'pointer'
      input.style.opacity = 1
    }
   
   let counter = 1;
   const atcBtn = document.querySelector('.product-form__submit, button[name="add"], button[type="submit"][name="add"]')
   const dynamicBtn = document.querySelector('.shopify-payment-button')
   if (dynamicBtn) dynamicBtn.disabled = true;
   
    let checkEveyScheduler = setInterval(function(){
    if(counter > 120){
      if (atcBtn) atcBtn.removeAttribute("disabled")
      if (dynamicBtn) {
        dynamicBtn.removeAttribute("disabled")
        enableBtnCSS(dynamicBtn)
      }
      clearInterval(checkEveyScheduler);
    }
    const eveyScheduler = document.querySelector('[data-evey-string]');
    if(eveyScheduler){
      if(!eveyScheduler.disabled){
        if (atcBtn) atcBtn.removeAttribute("disabled")
        if (dynamicBtn) {
          dynamicBtn.removeAttribute("disabled")
          enableBtnCSS(dynamicBtn)
        }
        clearInterval(checkEveyScheduler);
      }else{
        if (atcBtn) atcBtn.setAttribute('disabled','disabled')
        if (dynamicBtn) dynamicBtn.setAttribute('disabled','disabled')
      }
    }
    counter++
  }, 500);
 </script>
{% endif %}