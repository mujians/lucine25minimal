<div class="sketch-card sketch seed-9" style="padding: 1.5rem; margin: 1.5rem 0;">
  <svg class="sketch-border" viewBox="0 0 100 100" aria-hidden="true" preserveAspectRatio="none">
    <rect x="4" y="4" width="92" height="92" rx="12" fill="none" stroke="var(--christmas-gold)" stroke-width="3.2" stroke-linecap="round" stroke-dasharray="14 8 6 12 10 9" vector-effect="non-scaling-stroke"/>
  </svg>
  
  <form id="open-ticket-product-form" class="evey__multi-variant-selector" action="/cart/add" method="post" enctype="multipart/form-data" novalidate="novalidate">
    <!-- Match Evey structure: variant container like Evey -->
    <div class="evey__variants">
      <div class="evey__variant-container" style="display: flex; justify-content: space-between; align-items: center; padding: 5px 0; border-bottom: 1px solid rgba(18, 18, 18, 0.08);">
        <input type="hidden" name="id" value="10082871050579">
        
        <div class="evey__variant-title">
          <div class="evey__variant-name">Biglietto Open</div>
          <div class="evey__variant-price"><span class="money" id="open-ticket-price">€25,00</span></div>
        </div>
        
        <div class="evey__variant_quantity">
          <div class="quantity" style="display: flex; align-items: center;">
            <button type="button" class="quantity__button quantity__minus open-qty-btn" data-action="minus">
              <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" role="presentation" class="icon icon-minus" fill="none" viewBox="0 0 10 2" style="width: 10px; height: 10px;">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M.5 1C.5.7.7.5 1 .5h8a.5.5 0 110 1H1A.5.5 0 01.5 1z" fill="currentColor"></path>
              </svg>
            </button>
            <input name="quantity" class="quantity__input" type="number" min="0" value="1" id="open-quantity" style="width: 2.4rem; text-align: center; background: transparent; border-left: 0.1rem solid rgba(18,18,18,0.08); border-right: 0.1rem solid rgba(18,18,18,0.08); font-size: 14px;">
            <button type="button" class="quantity__button quantity__plus open-qty-btn" data-action="plus">
              <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" role="presentation" class="icon icon-plus" fill="none" viewBox="0 0 10 10" style="width: 10px; height: 10px;">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M1 4.51a.5.5 0 000 1h3.5l.01 3.5a.5.5 0 001-.01V5.5l3.5-.01a.5.5 0 00-.01-1H5.5L5.49.99a.5.5 0 00-1 .01v3.5l-3.5.01H1z" fill="currentColor"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Submit button matching Evey -->
    <button type="submit" id="open-add-to-cart" class="button button--full-width button--secondary" style="margin-top: 1rem;">
      <span id="open-cart-text">Aggiungi al Carrello</span>
    </button>
  </form>
</div>

<script>
// Load Open ticket product data and update price
fetch('/products/biglietto-open-2025.js')
  .then(response => response.json())
  .then(product => {
    if (product && product.price) {
      const priceElement = document.getElementById('open-ticket-price');
      if (priceElement) {
        const price = (product.price / 100).toFixed(2);
        priceElement.textContent = '€' + price.replace('.', ',');
      }
      
      // Update variant ID if different
      const variantId = product.variants && product.variants[0] ? product.variants[0].id : '10082871050579';
      const hiddenInput = document.querySelector('#open-ticket-product-form input[name="id"]');
      if (hiddenInput) {
        hiddenInput.value = variantId;
      }
    }
  })
  .catch(error => {
    // Silently fail if product cannot be loaded
  });

// Open ticket quantity controls
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.open-qty-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const input = document.getElementById('open-quantity');
      const action = this.getAttribute('data-action');
      let value = parseInt(input.value) || 1;
      
      if (action === 'plus' && value < 10) {
        input.value = value + 1;
      } else if (action === 'minus' && value > 1) {
        input.value = value - 1;
      }
    });
  });

  // Open ticket form submission
  const form = document.getElementById('open-ticket-product-form');
  if (form) {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = new FormData(this);
      const addBtn = document.getElementById('open-add-to-cart');
      const btnText = document.getElementById('open-cart-text');
      
      if (addBtn) addBtn.disabled = true;
      if (btnText) btnText.textContent = 'Aggiungendo...';
      
      fetch('/cart/add.js', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (btnText) btnText.textContent = 'Aggiunto! ✓';
        setTimeout(() => {
          window.location.href = '/cart';
        }, 800);
      })
      .catch(error => {
        console.error('Error:', error);
        if (btnText) btnText.textContent = 'Errore - Riprova';
        if (addBtn) addBtn.disabled = false;
        setTimeout(() => {
          if (btnText) btnText.textContent = 'Aggiungi al Carrello';
        }, 2000);
      });
    });
  }
});
</script>

<style>
/* Open Ticket - Match Evey styling */
.sketch-card.seed-9 .quantity {
  display: flex;
  align-items: center;
  border: 0.1rem solid rgba(18, 18, 18, 0.08);
  border-radius: 4px;
  width: fit-content;
}

.sketch-card.seed-9 .quantity__button {
  width: 45px;
  height: 45px;
  background: transparent;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: rgb(18, 18, 18);
}

.sketch-card.seed-9 .quantity__button:hover {
  background: rgba(18, 18, 18, 0.06);
}

.sketch-card.seed-9 .quantity__input {
  width: 2.4rem;
  text-align: center;
  background: transparent;
  border: none;
  border-left: 0.1rem solid rgba(18, 18, 18, 0.08);
  border-right: 0.1rem solid rgba(18, 18, 18, 0.08);
  font-size: 14px;
  padding: 0;
  height: 45px;
}

.sketch-card.seed-9 .evey__variant-name {
  font-weight: bold;
}

.sketch-card.seed-9 .money {
  font-weight: normal;
}

.sketch-card.seed-9 .button--secondary {
  background: #dc2626;
  color: white;
  padding: 1rem 2rem;
  border-radius: 8px;
  font-weight: 600;
  font-size: 1.1rem;
  border: none;
  cursor: pointer;
  font-family: 'Providence Sans', -apple-system, sans-serif;
  text-transform: uppercase;
  width: 100%;
}

.sketch-card.seed-9 .button--secondary:hover {
  background: #b91c1c;
}

/* Mobile responsive */
@media (max-width: 768px) {
  .sketch-card.seed-9 .evey__variant-container {
    flex-direction: column !important;
    gap: 1rem !important;
  }
}
</style>