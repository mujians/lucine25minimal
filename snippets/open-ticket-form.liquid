<div class="sketch-card sketch seed-9" style="padding: 1.5rem; margin: 1.5rem 0;">
  <svg class="sketch-border" viewBox="0 0 100 100" aria-hidden="true" preserveAspectRatio="none">
    <defs>
      <filter id="wobble-open">
        <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="1" seed="9"/>
        <feDisplacementMap in="SourceGraphic" scale="1"/>
      </filter>
    </defs>
    <rect x="4" y="4" width="92" height="92" rx="12" fill="none" stroke="var(--christmas-gold)" stroke-width="3.2" stroke-linecap="round" stroke-dasharray="14 8 6 12 10 9" vector-effect="non-scaling-stroke" filter="url(#wobble-open)"/>
  </svg>
  
  <form id="open-ticket-product-form" action="/cart/add" method="post" enctype="multipart/form-data" novalidate="novalidate">
    <!-- Titolo e descrizione -->
    <div style="margin-bottom: 1.5rem;">
      <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
        <h4 style="color: var(--christmas-gold); margin: 0; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; font-size: 1.35rem;">ðŸ¥‡ Biglietto Open</h4>
        <span style="background: var(--christmas-red); color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">ESCLUSIVO</span>
      </div>
      <p class="lead" style="color: var(--christmas-green); font-weight: 600; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 0.5px; margin: 0 0 0.25rem;">Pass premium per accedere senza prenotazione</p>
      <p class="meta" style="color: rgba(255,255,255,0.9); line-height: 1.6; margin: 0; font-size: 1.125rem; opacity: 0.85;">Valido in qualsiasi giorno e orario disponibile â€¢ Accesso prioritario sempre</p>
    </div>
    
    <!-- Riga con nome, prezzo e controlli quantitÃ  - allineata al design system -->
    <div style="display: flex; align-items: center; gap: 1.5rem; flex-wrap: wrap;">
      <!-- Info prezzo -->
      <div style="flex: 1; min-width: 200px;">
        <div style="display: flex; align-items: center; gap: 0.5rem;">
          <span class="menu-price" style="color: var(--christmas-green); font-weight: 700; font-size: 1.4rem;" id="open-ticket-price">â‚¬25,00</span>
          <span style="color: rgba(255,255,255,0.7); text-decoration: line-through; font-size: 1.125rem;">â‚¬30,00</span>
        </div>
        <div style="background: rgba(5,150,105,0.2); color: var(--christmas-green); padding: 4px 8px; border-radius: 6px; font-size: 12px; font-weight: 600; margin-top: 0.25rem; display: inline-block;">SCONTO ONLINE</div>
      </div>
      
      <!-- Controlli quantitÃ  - seguendo il pattern della pagina funzionante -->
      <div style="display: flex; align-items: center; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(255,255,255,0.05);">
        <button type="button" class="open-qty-btn" data-action="minus" style="background: rgba(255,255,255,0.1); border: none; color: white; width: 32px; height: 32px; border-radius: 6px; cursor: pointer; font-size: 1.2rem; font-family: inherit; margin: 4px;">âˆ’</button>
        <input type="number" name="quantity" id="open-quantity" value="1" min="1" max="10" style="width: 50px; text-align: center; background: transparent; border: none; color: white; padding: 0.5rem; font-size: 1.125rem; font-weight: 600; font-family: inherit;">
        <button type="button" class="open-qty-btn" data-action="plus" style="background: rgba(255,255,255,0.1); border: none; color: white; width: 32px; height: 32px; border-radius: 6px; cursor: pointer; font-size: 1.2rem; font-family: inherit; margin: 4px;">+</button>
      </div>
      
      <!-- Pulsante aggiungi - seguendo il pattern CTA della pagina funzionante -->
      <input type="hidden" name="id" value="10082871050579">
      <button type="submit" id="open-add-to-cart" class="cta" style="background: var(--christmas-red); color: white; padding: 1rem 2rem; border-radius: 8px; text-decoration: none; display: inline-block; font-weight: 600; font-size: 1.1rem; border: none; cursor: pointer; font-family: inherit; text-transform: uppercase; letter-spacing: 0.5px;">
        <span id="open-cart-text">Aggiungi al Carrello</span>
      </button>
    </div>
  </form>
</div>

<script>
// Load Open ticket product data and update price
fetch('/products/biglietto-open-2025.js')
  .then(response => response.json())
  .then(product => {
    if (product && product.price) {
      const priceElement = document.getElementById('open-ticket-price');
      if (priceElement) {
        const price = (product.price / 100).toFixed(2);
        priceElement.textContent = 'â‚¬' + price.replace('.', ',');
      }
      
      // Update variant ID if different
      const variantId = product.variants && product.variants[0] ? product.variants[0].id : '10082871050579';
      const hiddenInput = document.querySelector('#open-ticket-product-form input[name="id"]');
      if (hiddenInput) {
        hiddenInput.value = variantId;
      }
    }
  })
  .catch(error => {
    // Silently fail if product cannot be loaded
  });

// Open ticket quantity controls
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.open-qty-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const input = document.getElementById('open-quantity');
      const action = this.getAttribute('data-action');
      let value = parseInt(input.value) || 1;
      
      if (action === 'plus' && value < 10) {
        input.value = value + 1;
      } else if (action === 'minus' && value > 1) {
        input.value = value - 1;
      }
    });
  });

  // Open ticket form submission
  const form = document.getElementById('open-ticket-product-form');
  if (form) {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = new FormData(this);
      const addBtn = document.getElementById('open-add-to-cart');
      const btnText = document.getElementById('open-cart-text');
      
      if (addBtn) addBtn.disabled = true;
      if (btnText) btnText.textContent = 'Aggiungendo...';
      
      fetch('/cart/add.js', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (btnText) btnText.textContent = 'Aggiunto! âœ“';
        setTimeout(() => {
          window.location.href = '/cart';
        }, 800);
      })
      .catch(error => {
        console.error('Error:', error);
        if (btnText) btnText.textContent = 'Errore - Riprova';
        if (addBtn) addBtn.disabled = false;
        setTimeout(() => {
          if (btnText) btnText.textContent = 'Aggiungi al Carrello';
        }, 2000);
      });
    });
  }
});
</script>

<style>
/* Open Ticket hover effects - allineati al pattern della pagina funzionante */
.sketch-card.seed-9 .open-qty-btn:hover {
  background: rgba(255,255,255,0.2) !important;
  transform: translateY(-1px);
  transition: all 0.3s ease;
}

.sketch-card.seed-9 #open-add-to-cart:hover {
  background: #b91c1c !important;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
  transition: all 0.3s ease;
}

.sketch-card.seed-9 #open-quantity:focus {
  outline: none;
  box-shadow: 0 0 0 2px var(--christmas-gold);
}

/* Open Ticket responsive - seguendo il pattern della pagina funzionante */
@media (max-width: 768px) {
  .sketch-card.seed-9 form > div {
    flex-direction: column !important;
    text-align: center;
    gap: 1.5rem !important;
  }
  
  .sketch-card.seed-9 h4 {
    font-size: 1.3rem !important;
  }
  
  .sketch-card.seed-9 .lead {
    font-size: 1.125rem !important;
  }
  
  .sketch-card.seed-9 .meta {
    font-size: 1rem !important;
  }
  
  /* Responsive controls layout */
  .sketch-card.seed-9 form > div > div {
    width: 100% !important;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
  }
  
  /* Center quantity controls */
  .sketch-card.seed-9 form > div > div:has(input[type="number"]) {
    justify-content: center !important;
  }
  
  /* Full width button on mobile */
  .sketch-card.seed-9 #open-add-to-cart {
    width: 100%;
    max-width: 300px;
  }
}
</style>