<script>

   function blockMultiTicket(){
    const fetchEventId = document.querySelector('input[name="properties[_event_id]"]');
    const eveyVariantContainers = document.querySelectorAll('.evey__variant-container');
    const eveyVariants = document.querySelector('.evey__variants');
    const fetchEventIdobserver = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
          
        if (document.querySelector('input[name="properties[_event_id]"]').value == '') {
            eveyVariantContainers.forEach(container => {
              container.style.pointerEvents = 'none';
              container.style.opacity = '0.6';
              container.style.filter = 'grayscale(50%)';
            });
            eveyVariants.style.cursor = 'not-allowed';
            }else{
                eveyVariantContainers.forEach(container => {
                  container.style.pointerEvents = 'all';
                  container.style.opacity = '1';
                  container.style.filter = 'none';
                });
                eveyVariants.style.cursor = 'auto';
            }
      });
    });
    
    const fetchEventIdconfig = {
      attributes: true,
      childList: true,
      characterData: true,
      subtree: true
    };
    
    fetchEventIdobserver.observe(fetchEventId, fetchEventIdconfig);

  }

  
  const fetchEveyMetaData = {{ product.metafields.evey.event.value | default: product.metafields.evey.event | json }};
  if (fetchEveyMetaData && fetchEveyMetaData.date_type === "recurring") {
    let productBlocks = document.querySelector("#MainContent");
    let pbObserver = new MutationObserver(function () {
        // const checkForEveyScheduler = document.querySelector('#evey-schedule-calendar-modal');
        const fetchEventId = document.querySelector('input[name="properties[_event_id]"]')
        const eveyVariantContainers = document.querySelectorAll('.evey__variant-container');
        const eveyVariants = document.querySelector('.evey__variants');
        if (eveyVariantContainers && eveyVariants && fetchEventId) {
            pbObserver.disconnect();
            
            // Add our custom elements when Evey loads
            setTimeout(() => {
              addTicketTooltips();
            }, 2000);
            
            eveyVariantContainers.forEach(container => {
              container.style.pointerEvents = 'none';
              container.style.opacity = '0.6';
              container.style.filter = 'grayscale(50%)';
            });
            eveyVariants.style.cursor = 'not-allowed';
            blockMultiTicket();
        }
    });

    pbObserver.observe(productBlocks, { attributes: false, childList: true, subtree: true });
  }


  // Add smart tooltips - hover on desktop, click on mobile
  function addTicketTooltips() {
    const ticketInfo = {
      'Intero': 'Biglietto standard per adulti. Include l\'accesso completo al parco nel giorno e orario selezionato.',
      'Ridotto': 'Per bambini 3-12 anni e disabili. L\'accompagnatore di una persona disabile può anch\'esso acquistare un biglietto ridotto (1 disabile + 1 accompagnatore = 2 biglietti ridotti). Accesso prioritario.',
      'SaltaFila': 'Accesso prioritario senza code all\'ingresso. Include tutti i vantaggi del biglietto intero.',
      'Saltafila': 'Accesso prioritario senza code all\'ingresso. Include tutti i vantaggi del biglietto intero.'
    };

    setTimeout(() => {
      document.querySelectorAll('.evey__variant-name').forEach(nameElement => {
        const ticketType = nameElement.textContent.trim();
        if (ticketInfo[ticketType] && !nameElement.querySelector('.ticket-tooltip')) {
          nameElement.style.position = 'relative';
          
          const tooltip = document.createElement('div');
          tooltip.className = 'ticket-tooltip';
          tooltip.textContent = ticketInfo[ticketType];
          
          nameElement.appendChild(tooltip);
          
          // Mobile: click to show/hide
          if (window.innerWidth <= 768) {
            nameElement.addEventListener('click', function(e) {
              e.preventDefault();
              e.stopPropagation();
              
              // Hide all other tooltips first
              document.querySelectorAll('.ticket-tooltip').forEach(t => {
                if (t !== tooltip) {
                  t.classList.remove('show-mobile');
                }
              });
              
              // Toggle this tooltip
              tooltip.classList.toggle('show-mobile');
            });
          }
        }
      });
    }, 1000);
  }

  // Backup tooltip addition (in case main system doesn't work)
  setTimeout(() => {
    if (document.querySelectorAll('.ticket-tooltip').length === 0) {
      addTicketTooltips();
    }
  }, 4500);




</script>


<style>
/* Enhanced UX for disabled Evey elements */
.evey__multi-variant-selector button[type="submit"][name="add"]:disabled {
  opacity: 0.6 !important;
  cursor: not-allowed !important;
  position: relative;
}

/* Quantity buttons - let Shopify handle them naturally */

/* Remove hint box - layout is now clear enough */

/* Keep Evey button more original - minimal changes */
button[data-evey-trigger] {
  /* Let Evey handle the button text naturally */
}


/* Product media padding removed - not needed as media is hidden */





/* Simple tooltip system */
.evey__variant-name {
  position: relative;
  cursor: help;
}

.evey__variant-name::after {
  content: 'ℹ️';
  font-size: 12px;
  margin-left: 6px;
  opacity: 0.7;
}

/* Desktop: hover only on variant name text, not quantity buttons */
@media (min-width: 769px) {
  .evey__variant-name:hover .ticket-tooltip {
    opacity: 1;
    visibility: visible;
  }
}

/* Mobile: click to show/hide */
@media (max-width: 768px) {
  .ticket-tooltip.show-mobile {
    opacity: 1;
    visibility: visible;
  }
}

.ticket-tooltip {
  position: absolute;
  top: 100%;
  left: 0;
  min-width: 200px;
  max-width: 300px;
  background: rgba(0, 0, 0, 0.9);
  color: white;
  padding: 10px;
  border-radius: 8px;
  font-size: 14px;
  line-height: 1.4;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  pointer-events: none;
}

</style>