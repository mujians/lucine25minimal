<!-- PRODUCT RECOMMENDATIONS SECTION -->
{% if recommendations.performed and recommendations.products_count > 0 %}
<div class="product-recommendations-section" style="margin-top: 4rem;">
  <div class="content-wrapper" style="max-width: 1200px; margin: 0 auto; padding: 0 1rem;">
    <div class="formatted-content" style="background: rgba(15, 47, 31, 0.4); border-radius: 16px; padding: 2rem; border: 1px solid rgba(255,255,255,0.1);">
      
      <!-- Section Header -->
      {% if section.settings.heading != blank %}
      <h2 style="color: var(--christmas-red); text-align: center; margin-bottom: 2rem; font-family: 'Homemade Apple', cursive;">
        {{ section.settings.heading }}
      </h2>
      {% endif %}
      
      <!-- Products Grid -->
      <div class="recommendations-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
        {% assign limit = section.settings.product_list_limit | default: 4 %}
        {% for product in recommendations.products limit: limit %}
          <div class="recommendation-card">
            <div class="sketch-card sketch seed-{{ forloop.index }}">
              <svg class="sketch-border" viewBox="0 0 100 100" aria-hidden="true" preserveAspectRatio="none">
                <defs>
                  <filter id="wobble-rec-{{ forloop.index }}">
                    <feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="1" seed="{{ forloop.index }}"/>
                    <feDisplacementMap in="SourceGraphic" scale="1.2"/>
                  </filter>
                </defs>
                <rect x="4" y="4" width="92" height="92" rx="12" 
                      fill="none" 
                      stroke="currentColor" 
                      stroke-width="2.8" 
                      stroke-linecap="round" 
                      stroke-dasharray="12 6 8 10" 
                      vector-effect="non-scaling-stroke" 
                      filter="url(#wobble-rec-{{ forloop.index }})"/>
              </svg>
              
              <div class="card-content" style="padding: 1.5rem;">
                <!-- Product Image -->
                {% if product.featured_image %}
                <div class="product-image" style="text-align: center; margin-bottom: 1rem;">
                  <img src="{{ product.featured_image | img_url: '200x200' }}" 
                       alt="{{ product.title }}" 
                       style="width: 100px; height: 100px; border-radius: 8px; object-fit: cover;">
                </div>
                {% endif %}
                
                <!-- Product Title -->
                <h3 style="color: var(--christmas-green); text-align: center; margin: 0 0 1rem 0; font-size: 1.1rem;">
                  {{ product.title }}
                </h3>
                
                <!-- Product Price -->
                <div class="price" style="text-align: center; margin-bottom: 1rem;">
                  {% if product.compare_at_price > product.price %}
                    <span style="color: rgba(255,255,255,0.6); text-decoration: line-through; font-size: 0.9rem;">
                      {{ product.compare_at_price | money }}
                    </span>
                    <br>
                  {% endif %}
                  <span style="color: var(--christmas-red); font-weight: 700; font-size: 1.2rem;">
                    {{ product.price | money }}
                  </span>
                </div>
                
                <!-- View Product Button -->
                <div style="text-align: center;">
                  <a href="{{ product.url }}" 
                     style="background: var(--christmas-gold); color: white; padding: 0.75rem 1.5rem; text-decoration: none; border-radius: 8px; display: inline-block; font-weight: 600; transition: all 0.3s; font-size: 0.9rem;"
                     onmouseover="this.style.opacity='0.9'; this.style.transform='translateY(-1px)'"
                     onmouseout="this.style.opacity='1'; this.style.transform='translateY(0)'">
                    üéüÔ∏è Vedi Dettagli
                  </a>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
      
    </div>
  </div>
</div>

<style>
/* Mobile Responsive */
@media (max-width: 768px) {
  .recommendations-grid {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)) !important;
    gap: 1rem !important;
  }
  
  .recommendation-card .card-content {
    padding: 1rem !important;
  }
  
  .recommendation-card h3 {
    font-size: 1rem !important;
  }
  
  .recommendation-card .product-image img {
    width: 80px !important;
    height: 80px !important;
  }
}
</style>
{% endif %}

{% schema %}
{
  "name": "Product Recommendations",
  "tag": "section",
  "class": "section-product-recommendations",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Ti potrebbero interessare"
    },
    {
      "type": "range",
      "id": "product_list_limit",
      "label": "Number of products to show",
      "min": 2,
      "max": 10,
      "step": 1,
      "default": 4
    }
  ]
}
{% endschema %}