<!-- CART TEMPLATE - Carrello Lucine di Natale -->
<!-- Navigation Container con Sidebar -->
<div class="navigation-container top" data-tabs-section>
  <!-- Mobile Burger Menu -->
  <div class="mobile-header">
    <button class="burger-menu" onclick="toggleMobileFooter()" aria-label="Apri menu">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </div>

  <!-- Desktop Sidebar Navigation -->
  <nav class="desktop-sidebar">
    <div class="sidebar-header">
      <a href="/" class="logo-link">
        <img src="https://cdn.shopify.com/s/files/1/0605/2983/6205/files/lucine-di-natale-logo-white-2025.png?v=1757004485" alt="Lucine di Natale" class="sidebar-logo" />
      </a>
      <p class="site-dates">Dal 6 dicembre al 6 gennaio</p>
      <p class="site-closed">chiuso il 24 e il 31 dicembre</p>
    </div>
    
    <div class="sidebar-menu">
      {% assign main_menu = linklists['menu-principale'] %}
      {% for link in main_menu.links %}
        <button class="nav-item" onclick="window.location.href='{{ link.url }}'">
          <span class="nav-icon">
            {% if link.title contains 'Biglietti' %}🎫
            {% elsif link.title contains 'FAQ' %}❓
            {% elsif link.title contains 'Eventi' %}🎄
            {% elsif link.title contains 'Menu' or link.title contains 'Ristoro' %}🍽️
            {% elsif link.title contains 'Storia' %}📖
            {% elsif link.title contains 'Visitare' %}👀
            {% elsif link.title contains 'Parcheggi' %}🚗
            {% else %}✨
            {% endif %}
          </span>
          <span class="nav-text">{{ link.title }}</span>
        </button>
      {% endfor %}
      
      <!-- Carrello attivo -->
      <button class="nav-item active">
        <span class="nav-icon">🛒</span>
        <span class="nav-text">Carrello</span>
      </button>
    </div>
    
    <div class="sidebar-footer">
      <p class="social-title">Seguici sui social</p>
      <div class="sidebar-social">
        <a href="#" class="social-icon" aria-label="TikTok">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19.59 6.69a4.83 4.83 0 01-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 01-5.2 1.74 2.89 2.89 0 012.31-4.64 2.93 2.93 0 01.88.13V9.4a6.37 6.37 0 00-1-.05A6.34 6.34 0 005 15.69a6.34 6.34 0 0011.36-3.81V6.27a8.16 8.16 0 004.91 1.62v-3.4a4.85 4.85 0 01-1.68.2z"/>
          </svg>
        </a>
        <a href="#" class="social-icon" aria-label="Instagram">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zM5.838 12a6.162 6.162 0 1112.324 0 6.162 6.162 0 01-12.324 0zM12 16a4 4 0 110-8 4 4 0 010 8zm4.965-10.405a1.44 1.44 0 112.881.001 1.44 1.44 0 01-2.881-.001z"/>
          </svg>
        </a>
        <a href="#" class="social-icon" aria-label="Facebook">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
          </svg>
        </a>
        <a href="#" class="social-icon" aria-label="Spotify">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/>
          </svg>
        </a>
      </div>
      
      <div class="sidebar-legal">
        <a href="https://lucinedinatale.it/pages/privacy-e-cookie-policy">Privacy</a>
        <span> • </span>
        <a href="https://lucinedinatale.it/policies/terms-of-service">Termini</a>
      </div>
      
      <div class="company-info">
        <p><strong>SPONDA MAGRA SRL</strong></p>
        <p>Via Griffi, 6, 21100 Varese</p>
        <p>P.IVA 12056440964</p>
      </div>
    </div>
  </nav>

  <!-- Content Area -->
  <div class="content-wrapper">
    <div class="content show">
      <div class="formatted-content">
        <div class="cart-mobile-compact" style="max-width: 800px; margin: 0 auto;">

<h3 style="color: var(--christmas-red); text-align: center; margin-bottom: 1.5rem;">Il Tuo Carrello</h3>
{% if cart.item_count > 0 %}
  <p style="text-align: center; color: rgba(255,255,255,0.9); font-size: 1.125rem;">
    Hai <strong>{{ cart.item_count }}</strong> {% if cart.item_count == 1 %}biglietto{% else %}biglietti{% endif %} nel carrello
  </p>
{% endif %}

{% if cart.item_count > 0 %}
  <!-- CART ITEMS -->
  <section style="margin: 2rem 0;">
    <form action="/cart" method="post" id="cart-form" style="display: contents;">
      {% for item in cart.items %}
      <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; display: flex; gap: 1.5rem; align-items: center;">
        <!-- Item Info -->
        <div style="flex: 1;">
          <h5 style="color: white; margin: 0 0 0.25rem 0; text-transform: uppercase; letter-spacing: 0.5px;">{{ item.product.title }}</h5>
          {% if item.variant.title != 'Default Title' or item.properties.size > 0 %}
            <p style="margin: 0; font-size: 1rem;">
              {% if item.variant.title != 'Default Title' %}
                <span style="color: var(--christmas-green); text-transform: uppercase; font-weight: 600;">{{ item.variant.title }}</span>
              {% endif %}
              {% for property in item.properties %}
                {% unless property.first contains '_' %}
                  {% if item.variant.title != 'Default Title' %}<span style="color: rgba(255,255,255,0.7);"> • {{ property.last }}</span>{% else %}<span style="color: rgba(255,255,255,0.7);">{{ property.last }}</span>{% endif %}
                {% endunless %}
              {% endfor %}
            </p>
          {% endif %}
        </div>
        
        <!-- Quantity Controls -->
        <div style="display: flex; align-items: center; gap: 0.5rem;">
          <button type="button" onclick="updateQuantity('{{ item.key }}', {{ item.quantity }} - 1)" style="background: rgba(255,255,255,0.1); border: none; color: white; width: 32px; height: 32px; border-radius: 6px; cursor: pointer; font-size: 1.2rem;">−</button>
          <input type="number" 
                 name="updates[{{ item.key }}]" 
                 value="{{ item.quantity }}" 
                 min="0" 
                 class="qty-input"
                 style="width: 50px; text-align: center; background: transparent; border: 1px solid rgba(255,255,255,0.2); color: white; padding: 0.5rem; border-radius: 6px;">
          <button type="button" onclick="updateQuantity('{{ item.key }}', {{ item.quantity }} + 1)" style="background: rgba(255,255,255,0.1); border: none; color: white; width: 32px; height: 32px; border-radius: 6px; cursor: pointer; font-size: 1.2rem;">+</button>
        </div>
        
        <!-- Item Price -->
        <div style="text-align: right; min-width: 100px;">
          <p style="margin: 0; color: var(--christmas-green); font-size: 1.2rem; font-weight: 700;">
            {{ item.final_line_price | money }}
          </p>
        </div>
        
        <!-- Remove Button -->
        <div>
          <button type="button" 
                  onclick="updateQuantity('{{ item.key }}', 0)" 
                  style="background: transparent; border: 1px solid rgba(220, 38, 38, 0.5); color: var(--christmas-red); padding: 0.5rem; border-radius: 6px; cursor: pointer;">
            🗑️
          </button>
        </div>
      </div>
      {% endfor %}
      
      <!-- Update Cart Button (hidden, triggered by JS) -->
      <button type="submit" name="update" id="update-cart-btn" style="display: none;">Aggiorna</button>
    </form>
  </section>

  <!-- CART SUMMARY -->
  <section style="position: relative; padding: 3rem; margin: 2rem 0;">
    <svg style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;" viewBox="0 0 100 100" aria-hidden="true" preserveAspectRatio="none">
      <defs>
        <filter id="wobble-summary">
          <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="1" seed="7"/>
          <feDisplacementMap in="SourceGraphic" scale="1"/>
        </filter>
      </defs>
      <rect x="2" y="2" width="96" height="96" rx="12" fill="none" stroke="currentColor" stroke-width="3.2" stroke-linecap="round" stroke-dasharray="14 8 6 12 10 9" vector-effect="non-scaling-stroke" filter="url(#wobble-summary)"/>
    </svg>
    
    <div style="display: flex; flex-direction: column; gap: 1rem; position: relative; z-index: 1;">
        <!-- Subtotal -->
        <div style="display: flex; justify-content: space-between; padding-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
          <span style="color: rgba(255,255,255,0.9); font-size: 1.125rem;">Subtotale</span>
          <span style="color: var(--christmas-green); font-size: 1.125rem; font-weight: 600;">{{ cart.total_price | money }}</span>
        </div>
        
        <!-- Discount Code -->
        <div style="padding-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
          <label style="color: var(--christmas-green); font-weight: 600; display: block; margin-bottom: 0.5rem;">🎁 Codice Sconto</label>
          <div style="display: flex; gap: 0.5rem;">
            <input type="text" 
                   id="discount-code" 
                   name="discount" 
                   placeholder="Inserisci codice..."
                   style="flex: 1; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 0.75rem; border-radius: 8px; font-size: 1.125rem;">
            <button type="button" 
                    onclick="applyDiscount()"
                    style="background: var(--christmas-green); color: white; border: none; padding: 0.75rem 1rem; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.875rem; font-family: 'Providence Sans', sans-serif !important; white-space: nowrap; flex-shrink: 0;">
              APPLICA
            </button>
          </div>
          {% if cart.cart_level_discount_applications.size > 0 %}
          <div style="margin-top: 0.5rem;">
            {% for discount in cart.cart_level_discount_applications %}
              <div style="display: flex; justify-content: space-between; align-items: center; background: rgba(139, 195, 74, 0.1); padding: 0.5rem; border-radius: 6px; margin-top: 0.5rem;">
                <span style="color: var(--christmas-green); font-size: 0.9rem;">
                  {{ discount.title }}
                </span>
                <span style="color: var(--christmas-green); font-weight: 600;">
                  -{{ discount.total_allocated_amount | money }}
                </span>
              </div>
            {% endfor %}
          </div>
          {% endif %}
        </div>
        
        <!-- Total -->
        <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; border-top: 2px solid var(--christmas-gold);">
          <span style="color: var(--christmas-gold); font-size: 1.3rem; font-weight: 700;">TOTALE</span>
          <span style="color: var(--christmas-green); font-size: 1.5rem; font-weight: 700;">{{ cart.total_price | money }}</span>
        </div>
        
        <!-- Checkout Button -->
        <button type="submit" 
                name="checkout" 
                form="cart-form"
                style="background: var(--christmas-red); color: white; border: none; padding: 1.2rem 2rem; border-radius: 12px; font-size: 1.125rem; font-weight: 600; cursor: pointer; margin-top: 1rem; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3); font-family: 'Providence Sans', sans-serif !important;">
          PROCEDI AL PAGAMENTO
        </button>
        
        <!-- Continue Shopping -->
        <a href="/products/biglietto-parco-lucine-di-natale-2025" 
           style="text-align: center; color: var(--christmas-green); text-decoration: underline; display: block; margin-top: 0.5rem; font-size: 1.125rem;">
          ← Torna ai Biglietti
        </a>
      </div>
  </section>

{% else %}
  <!-- EMPTY CART -->
  <section style="text-align: center; padding: 4rem 1rem;">
    <div style="background: rgba(255,255,255,0.04); border-radius: 12px; padding: 3rem 2rem; border: 1px dashed var(--christmas-gold);">
      <p style="font-size: 1.5rem; margin-bottom: 2rem; color: white;">Il tuo carrello è vuoto</p>
      <p style="color: rgba(255,255,255,0.8); margin-bottom: 2rem;">Non hai ancora aggiunto biglietti al carrello</p>
      <a href="/products/biglietto-parco-lucine-di-natale-2025" 
         style="background: var(--christmas-green); color: white; padding: 1rem 2rem; text-decoration: none; border-radius: 8px; display: inline-block; font-weight: 600;">
        Acquista Biglietti
      </a>
    </div>
  </section>
{% endif %}

        </div>
      </div>
    </div>
  </div>
</div>

<style>
/* Mobile Responsive */
@media (max-width: 768px) {
  /* Cart Items Mobile Compact Layout */
  .cart-mobile-compact div[style*="display: flex"][style*="gap: 1.5rem"][style*="align-items: center"] {
    flex-wrap: wrap !important;
    gap: 0.25rem !important;
    padding: 0.75rem !important;
  }
  
  /* Compact Item Info */
  .cart-mobile-compact div[style*="flex: 1"] {
    flex: 1 1 100% !important;
    text-align: center !important;
    order: 1 !important;
    margin-bottom: 0.5rem !important;
  }
  
  /* Compact Title Spacing */
  .cart-mobile-compact h5 {
    margin-bottom: 0.1rem !important;
  }
  
  /* Compact Controls Layout */
  .cart-mobile-compact div[style*="display: flex"][style*="align-items: center"][style*="gap: 0.5rem"] {
    flex: 1 1 auto !important;
    order: 2 !important;
    justify-content: center !important;
  }
  
  .cart-mobile-compact div[style*="text-align: right"] {
    flex: 1 1 auto !important;
    order: 3 !important;
    text-align: center !important;
  }
  
  .cart-mobile-compact div[style*="display: flex"][style*="gap: 1.5rem"][style*="align-items: center"] > div:last-child {
    flex: 0 0 auto !important;
    order: 4 !important;
  }
  
  /* Cart summary mobile padding */
  section[style*="position: relative"][style*="padding: 3rem"] {
    padding: 2rem !important;
    margin: 1.5rem 0 !important;
  }
  
  /* Input and Button Sizing - Minimum 16px for mobile */
  input[type="text"], input[type="number"] {
    font-size: 16px !important;
  }
  
  /* Button font-size minimum for mobile - except specific cases */
  button:not([onclick="applyDiscount()"]):not([onclick*="updateQuantity"]) {
    font-size: 16px !important;
  }
  
  /* Compact discount section on mobile */
  div[style*="display: flex"][style*="gap: 0.5rem"] {
    gap: 0.25rem !important;
  }
  
  /* APPLICA button - smaller to fit in grid */
  button[onclick="applyDiscount()"] {
    font-size: 12px !important;
    padding: 0.5rem 0.4rem !important;
    flex-shrink: 0 !important;
    white-space: nowrap !important;
    min-width: 50px !important;
    max-width: 60px !important;
  }
  
  /* Discount input - ensure it shrinks properly */
  input[id="discount-code"] {
    min-width: 0 !important;
    flex: 1 !important;
  }
  
  /* Prevent Horizontal Scroll */
  body {
    overflow-x: hidden !important;
  }
  
  /* Container Width Fix */
  * {
    max-width: 100% !important;
    box-sizing: border-box !important;
  }
}
</style>

<script>
function updateQuantity(key, newQty) {
  // Trova l'input corretto e aggiorna il valore
  const input = document.querySelector(`input[name="updates[${key}]"]`);
  if (input) {
    input.value = Math.max(0, newQty);
    // Invia automaticamente il form
    document.getElementById('update-cart-btn').click();
  }
}

// Apply discount code
function applyDiscount() {
  const discountCode = document.getElementById('discount-code').value;
  if (discountCode) {
    // Shopify discount code application via fetch
    fetch('/discount/' + encodeURIComponent(discountCode) + '?redirect=/cart')
      .then(() => {
        window.location.href = '/cart';
      })
      .catch(err => {
        alert('Errore nell\'applicazione del codice sconto');
      });
  }
}


// Auto-update cart when quantity input changes
document.addEventListener('DOMContentLoaded', function() {
  const qtyInputs = document.querySelectorAll('.qty-input');
  qtyInputs.forEach(input => {
    input.addEventListener('change', function() {
      document.getElementById('update-cart-btn').click();
    });
  });
  
  
  // Handle Enter key on discount code
  const discountInput = document.getElementById('discount-code');
  if (discountInput) {
    discountInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        applyDiscount();
      }
    });
  }
});
</script>

<!-- BACK TO TOP BUTTON -->
<button id="back-to-top" onclick="scrollToTop()">↑</button>

<script>
// BACK TO TOP BUTTON
function scrollToTop() {
  const contentArea = document.querySelector('.content.show');
  if (contentArea) {
    contentArea.scrollTo({
      top: 0,
      behavior: 'smooth'
    });
  } else {
    window.scrollTo({
      top: 0,
      behavior: 'smooth'
    });
  }
}

// Show/hide back to top button based on scroll
function handleBackToTopVisibility() {
  const backToTopBtn = document.getElementById('back-to-top');
  const contentArea = document.querySelector('.content.show');
  
  if (backToTopBtn && contentArea) {
    if (contentArea.scrollTop > 300) {
      backToTopBtn.classList.add('show');
    } else {
      backToTopBtn.classList.remove('show');
    }
  }
}

// Add scroll listener for back to top button
document.addEventListener('DOMContentLoaded', function() {
  const contentArea = document.querySelector('.content');
  if (contentArea) {
    contentArea.addEventListener('scroll', handleBackToTopVisibility);
  }
});
</script>

<!-- GLOBAL FOOTER - Mobile menu footer -->
{% render 'footer-snap' %}